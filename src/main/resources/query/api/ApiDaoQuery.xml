<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.honsul.inthewood.api.dao.ApiDao">

    <select id="getResort" parameterType="map" resultType="Resort">
      SELECT RESORT_ID, RESORT_NM
        FROM RESORT
       WHERE RESORT_ID = #{resortId}
    </select>  
    
    <select id="selectResort" resultType="Resort">
      SELECT RESORT_ID, RESORT_NM
        FROM RESORT
    </select>  
    
    <select id="selectResortRoom" parameterType="map" resultType="Room">
      SELECT b.RESORT_ID
           , b.RESORT_NM
           , a.ROOM_NO
           , a.ROOM_NM
           , a.ROOM_TYPE
           , a.ROOM_TYPE_NM
           , a.OCCUPANCY
           , a.PRICE
           , a.PEAK_PRICE
        FROM ROOM a
           , RESORT b
       WHERE b.RESORT_ID = a.RESORT_ID
         AND a.RESORT_ID = #{resortId}
    </select>      
    
    <select id="selectResortBooking" parameterType="map" resultType="Booking">
      SELECT b.RESORT_ID
           , b.RESORT_NM
           , a.BOOKING_DT
           , a.ROOM_NO
           , a.ROOM_NM
        FROM BOOKING a
           , RESORT b
       WHERE b.RESORT_ID = a.RESORT_ID
         AND a.RESORT_ID = #{resortId}
       <choose>
          <when test="bookingDt != null and bookingDt.equals('holiday')">    
            AND WEEKDAY(a.BOOKING_DT) = 5
          </when>
          <when test="bookingDt != null and !bookingDt.equals('')">
            AND a.BOOKING_DT = #{bookingDt}
          </when>          
       </choose>         
       ORDER BY a.BOOKING_DT
    </select>     
    
    <select id="selectBooking" parameterType="map" resultType="Booking">
      SELECT b.RESORT_ID
           , b.RESORT_NM
           , a.BOOKING_DT
           , a.ROOM_NO
           , a.ROOM_NM
        FROM BOOKING a
           , RESORT b
       WHERE b.RESORT_ID = a.RESORT_ID
       <choose>
          <when test="bookingDt != null and bookingDt.equals('holiday')">    
            AND WEEKDAY(a.BOOKING_DT) = 5
          </when>
          <otherwise>
            AND a.BOOKING_DT = #{bookingDt}
          </otherwise>
       </choose>     
       ORDER BY a.RESORT_ID 
    </select>
    
</mapper>

